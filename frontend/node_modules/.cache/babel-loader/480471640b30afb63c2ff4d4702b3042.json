{"ast":null,"code":"import _toConsumableArray from\"C:/Users/\\u0420\\u043E\\u043C\\u0430\\u043D/Desktop/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/\\u0420\\u043E\\u043C\\u0430\\u043D/Desktop/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from\"react\";import Footer from\"./Footer\";import Header from\"./Header\";import Main from\"./Main\";import ImagePopup from\"./ImagePopup\";import api from\"../utils/Api\";import*as auth from\"../utils/Auth\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import ProtectedRoute from\"./ProtectedRoute\";import{Route,Routes,Navigate,useNavigate,useLocation}from\"react-router-dom\";import Register from\"./Register\";import Login from\"./Login\";import InfoTooltip from\"./InfoTooltip\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),loggedIn=_React$useState2[0],setLoggedIn=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),successReg=_React$useState4[0],setSuccessReg=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditProfilePopupOpen=_React$useState6[0],setIsEditProfilePopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isAddPlacePopupOpen=_React$useState8[0],setIsAddPlacePopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isEditAvatarPopupOpen=_React$useState10[0],setIsEditAvatarPopupOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isInfoTooltipOpen=_React$useState12[0],setIsInfoTooltipOpen=_React$useState12[1];var _React$useState13=React.useState(null),_React$useState14=_slicedToArray(_React$useState13,2),selectedCard=_React$useState14[0],setSelectedCard=_React$useState14[1];var _React$useState15=React.useState({}),_React$useState16=_slicedToArray(_React$useState15,2),currentUser=_React$useState16[0],setCurrentUser=_React$useState16[1];var _React$useState17=React.useState([]),_React$useState18=_slicedToArray(_React$useState17,2),cards=_React$useState18[0],setCards=_React$useState18[1];var _React$useState19=React.useState([]),_React$useState20=_slicedToArray(_React$useState19,2),emails=_React$useState20[0],setEmails=_React$useState20[1];var navigate=useNavigate();var location=useLocation();React.useEffect(function(){api.getCards().then(function(card){return setCards(card);}).catch(function(err){return console.log(err);});},[]);React.useEffect(function(){api.getUserInfo().then(function(info){return setCurrentUser(info);}).catch(function(err){return console.log(err);});},[]);React.useEffect(function(){if(loggedIn){navigate(\"/main\");}},[loggedIn,navigate]);React.useEffect(function(){if(localStorage.getItem(\"token\")){var token=localStorage.getItem(\"token\");auth.checkToken(token).then(function(res){if(res){setLoggedIn(true);setEmails(res.data.email);}});}},[]);function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleCardCLick(card){setSelectedCard(card);}function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditProfilePopupOpen(false);setSelectedCard(null);setIsInfoTooltipOpen(false);}function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(user){return user._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){return console.log(err);});}function handleCardDelete(card){// Отправляем запрос в API и удаляем карточку, создаем копию массива, исключив удаленную карточку\napi.deleteCard(card._id).then(function(){setCards(function(state){return state.filter(function(c){return c._id!==card._id;});});}).catch(function(err){return console.log(err);});}function handleUpdateUser(data){api.setUserInfo(data).then(function(info){setCurrentUser(info);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleUpdateAvatar(data){api.setUserAvatar(data).then(function(info){setCurrentUser(info);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(data){api.addNewCard(data).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.log(err);});}function handleLogin(formData){auth.authorize(formData.email,formData.password).then(function(data){localStorage.setItem('token',data.token);setLoggedIn(true);navigate(\"/main\");}).catch(function(err){return console.log(err);});}function handleRegistration(formData){auth.register(formData.email,formData.password).then(function(){setSuccessReg(true);setIsInfoTooltipOpen(true);navigate(\"/sign-in\");}).catch(function(err){console.log(err);setSuccessReg(false);setIsInfoTooltipOpen(true);});}function logout(){setLoggedIn(false);localStorage.removeItem('token');navigate(\"/sign-in\");}return/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,email:emails,logout:logout,location:location}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/main\",element:/*#__PURE__*/_jsxs(ProtectedRoute,{loggedIn:loggedIn,children:[/*#__PURE__*/_jsx(Main,{onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardCLick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups})]})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",element:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Register,{handleRegistration:handleRegistration}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,isSuccess:successReg,onClose:closeAllPopups})]})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",element:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,isSuccess:successReg,onClose:closeAllPopups})]})}),/*#__PURE__*/_jsx(Route,{path:\"/\",element:loggedIn?/*#__PURE__*/_jsx(Navigate,{to:\"/main\"}):/*#__PURE__*/_jsx(Navigate,{to:\"/sign-in\"})})]})]});}export default App;","map":{"version":3,"sources":["C:/Users/Роман/desktop/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","Footer","Header","Main","ImagePopup","api","auth","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","Route","Routes","Navigate","useNavigate","useLocation","Register","Login","InfoTooltip","App","useState","loggedIn","setLoggedIn","successReg","setSuccessReg","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isInfoTooltipOpen","setIsInfoTooltipOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","emails","setEmails","navigate","location","useEffect","getCards","then","card","catch","err","console","log","getUserInfo","info","localStorage","getItem","token","checkToken","res","data","email","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardCLick","closeAllPopups","handleCardLike","isLiked","likes","some","user","_id","changeLikeCardStatus","newCard","state","map","c","handleCardDelete","deleteCard","filter","handleUpdateUser","setUserInfo","handleUpdateAvatar","setUserAvatar","handleAddPlaceSubmit","addNewCard","handleLogin","formData","authorize","password","setItem","handleRegistration","register","logout","removeItem"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport Footer from \"./Footer\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/Api\";\nimport * as auth from \"../utils/Auth\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport { Route, Routes, Navigate, useNavigate, useLocation } from \"react-router-dom\";\nimport Register from \"./Register\";\nimport Login from \"./Login\";\nimport InfoTooltip from \"./InfoTooltip\";\n\nfunction App() {\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [successReg, setSuccessReg] = React.useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] =\n    React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] =\n    React.useState(false);\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState(null);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  const [emails, setEmails] = React.useState([]);\n  const navigate = useNavigate();\n  const location = useLocation();\n  React.useEffect(() => {\n    api\n      .getCards()\n      .then((card) => setCards(card))\n      .catch((err) => console.log(err));\n  }, []);\n\n  React.useEffect(() => {\n    api\n      .getUserInfo()\n      .then((info) => setCurrentUser(info))\n      .catch((err) => console.log(err));\n  }, []);\n\n  React.useEffect(() => {\n    if (loggedIn) {\n      navigate(\"/main\");\n    }\n  }, [loggedIn, navigate]);\n\n  React.useEffect(() => {\n    if (localStorage.getItem(\"token\")) {\n      const token = localStorage.getItem(\"token\");\n      auth.checkToken(token)\n      .then((res) => {\n        if (res) {\n          setLoggedIn(true);\n          setEmails(res.data.email);\n        }\n      });\n    }\n  }, []);\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleCardCLick(card) {\n    setSelectedCard(card);\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setSelectedCard(null);\n    setIsInfoTooltipOpen(false);\n  }\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some((user) => user._id === currentUser._id);\n\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api\n      .changeLikeCardStatus(card._id, !isLiked)\n      .then((newCard) => {\n        setCards((state) =>\n          state.map((c) => (c._id === card._id ? newCard : c))\n        );\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleCardDelete(card) {\n    // Отправляем запрос в API и удаляем карточку, создаем копию массива, исключив удаленную карточку\n    api\n      .deleteCard(card._id)\n      .then(() => {\n        setCards((state) => state.filter((c) => c._id !== card._id));\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleUpdateUser(data) {\n    api\n      .setUserInfo(data)\n      .then((info) => {\n        setCurrentUser(info);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleUpdateAvatar(data) {\n    api\n      .setUserAvatar(data)\n      .then((info) => {\n        setCurrentUser(info);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleAddPlaceSubmit(data) {\n    api\n      .addNewCard(data)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleLogin(formData) {\n    auth\n      .authorize(formData.email, formData.password)\n      .then((data) => {\n        localStorage.setItem('token', data.token);\n        setLoggedIn(true);\n        navigate(\"/main\");\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleRegistration(formData) {\n    auth\n      .register(formData.email, formData.password)\n      .then(() => {\n        setSuccessReg(true);\n        setIsInfoTooltipOpen(true);\n        navigate(\"/sign-in\");\n      })\n      .catch((err) => {\n        console.log(err);\n        setSuccessReg(false);\n        setIsInfoTooltipOpen(true);\n      });\n  }\n\n  function logout() {\n    setLoggedIn(false);\n    localStorage.removeItem('token');\n    navigate(\"/sign-in\");\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <Header loggedIn={loggedIn} email={emails} logout={logout} location={location}/>\n      <Routes>\n        <Route\n          path=\"/main\"\n          element={\n            <ProtectedRoute loggedIn={loggedIn}>\n              <Main\n                onEditAvatar={handleEditAvatarClick}\n                onEditProfile={handleEditProfileClick}\n                onAddPlace={handleAddPlaceClick}\n                onCardClick={handleCardCLick}\n                cards={cards}\n                onCardLike={handleCardLike}\n                onCardDelete={handleCardDelete}\n              />\n              <Footer />\n              <EditProfilePopup\n                isOpen={isEditProfilePopupOpen}\n                onClose={closeAllPopups}\n                onUpdateUser={handleUpdateUser}\n              />\n              <AddPlacePopup\n                isOpen={isAddPlacePopupOpen}\n                onClose={closeAllPopups}\n                onAddPlace={handleAddPlaceSubmit}\n              />\n              <EditAvatarPopup\n                isOpen={isEditAvatarPopupOpen}\n                onClose={closeAllPopups}\n                onUpdateAvatar={handleUpdateAvatar}\n              />\n              <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/sign-up\"\n          element={\n            <>\n              <Register handleRegistration={handleRegistration} />\n              <InfoTooltip\n                isOpen={isInfoTooltipOpen}\n                isSuccess={successReg}\n                onClose={closeAllPopups}\n              />\n            </>\n          }\n        />\n        <Route\n          path=\"/sign-in\"\n          element={\n            <>\n              <Login handleLogin={handleLogin} />\n              <InfoTooltip\n                isOpen={isInfoTooltipOpen}\n                isSuccess={successReg}\n                onClose={closeAllPopups}\n              />\n            </>\n          }\n        />\n        <Route\n          path=\"/\"\n          element={\n            loggedIn ? <Navigate to=\"/main\" /> : <Navigate to=\"/sign-in\" />\n          }\n        />\n      </Routes>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}